# 体感切水果游戏 🍉✋

一个使用 MediaPipe 和 OpenCV 开发的体感互动游戏，通过手部挥动轨迹切水果！

## 🎮 游戏特色

- **手势识别**：使用 MediaPipe 实时追踪手部动作，支持自适应坐标平滑
- **丰富素材**：支持10种普通水果 + 2种特殊水果（西瓜、火龙果）的PNG图片素材，带透明通道
- **刀光特效**：可选择的刀光样式，切水果时显示炫酷刀光效果
- **汁水特效**：水果被切碎时根据水果类型显示对应颜色的汁水炸裂特效（橙色、绿色、粉色、红色）
- **连击系统**：连续切中水果触发连击，达到10/15/20连击时显示特殊特效
- **炸弹系统**：普通炸弹（扣分）和致命炸弹（游戏结束），增加游戏挑战性
- **真实切割**：使用实际的左右切半图片，展现真实切水果效果
- **物理效果**：水果旋转、碎片飞散、渐隐动画
- **动态难度**：水果生成速度逐渐加快，挑战你的反应速度
- **音效支持**：切水果和爆炸音效（需要安装pygame）
- **实时反馈**：显示分数、漏接数、炸弹数和连击数

## 🎯 游戏规则

1. 水果从屏幕底部随机抛出
2. 挥动食指，让轨迹碰到水果即可切开
3. **普通水果**：每切一个得 10 分
4. **特殊水果**（西瓜、火龙果）：每切一个得 20 分，切开后分成8片飞散
5. **连击系统**：连续切中水果会累积连击数，漏掉或切到炸弹会中断连击
6. **炸弹**：
   - 普通炸弹：切到扣 20 分，最多切到 3 个后游戏结束
   - 致命炸弹（红色）：切到立即游戏结束
7. 漏接 5 个水果游戏结束

## 📋 系统要求

- Python 3.8+
- 摄像头
- Windows/Linux/MacOS

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行游戏

```bash
python main.py
```

### 3. 控制说明

#### 游戏开始前
- **手指悬停**：在刀光选择界面，手指悬停在刀光上3秒即可选择该刀光样式
- **1/2 键**：快速选择刀光样式1或2
- **Q 键**：退出选择界面（默认选择刀光1）

#### 游戏中
- **挥动食指**：切水果
- **R 键**：重新开始游戏
- **Q 键**：退出游戏
- **D 键**：开启/关闭调试模式（显示速度和平滑参数）
- **1/2/3 键**：切换平滑算法（EWMA/移动平均/卡尔曼滤波）
- **0 键**：关闭平滑（使用原始坐标）

## 🎨 游戏画面

- **主游戏区域**：彩色水果、刀光轨迹、汁水特效和连击特效
- **左上角信息**：
  - 分数（Score）
  - 漏接数（Missed）
  - 炸弹数（Bombs Hit）
  - 连击数（Combo）
  - 对象数量（调试用）
- **游戏结束时**：显示最终分数和最大连击数

## 🍎 游戏素材

### 普通水果（10种）
每种水果有3张PNG图片（带透明通道）：完整图片、左半边、右半边

| 水果类型 | 完整图片 | 左半边 | 右半边 | 汁水颜色 |
|---------|---------|--------|--------|---------|
| 香蕉 (banana) | banana.png | bananal.png | bananar.png | 橙色 |
| 菠萝 (boluo) | boluo.png | boluol.png | boluor.png | 橙色 |
| 冰香蕉 (iceBanana) | iceBanana.png | iceBananal.png | iceBananar.png | 绿色 |
| 芒果 (Mango) | Mango.png | Mangol.png | Mangor.png | 橙色 |
| 木瓜 (mugua) | mugua.png | mugual.png | muguar.png | 橙色 |
| 桃子 (peach) | peach.png | peachl.png | peachr.png | 粉色 |
| 梨 (pear) | pear.png | pearl.png | pearr.png | 绿色 |
| 菠萝 (pineapple) | pineapple.png | pineapplel.png | pineappler.png | 橙色 |
| 草莓 (strawberry) | strawberry.png | strawberryl.png | strawberryr.png | 红色 |
| b1 | b1.png | bl.png | br.png | 橙色 |

### 特殊水果（2种）
切开后分成8片飞散，分值更高（20分）

| 水果类型 | 完整图片 | 切片图片 | 汁水颜色 |
|---------|---------|---------|---------|
| 西瓜 (watermelon) | watermelon.png | watermelon1-8.png | 红色 |
| 火龙果 (dragonfruit) | all.png | 001-008.png | 粉色 |

### 特效素材
- **刀光特效**：`daoguang/dao1.png`, `dao2.png`
- **汁水特效**：`texiao/guozhi1-4.png`（橙色、绿色、粉色、红色）
- **连击特效**：`texiao/combo1-3.png`（10/15/20连击）
- **炸弹素材**：`zhadan/boom1-2.png`（普通/致命炸弹）
- **爆炸特效**：`zhadan/zha01-02.png`

### 音效素材
- **切水果音效**：`yinxiao/qieshuiguoyinxiao.mp3`
- **爆炸音效**：`yinxiao/baozhayinxiao.mp3`

所有素材存放在对应的目录下（`sucai/`, `texiao/`, `daoguang/`, `zhadan/`, `yinxiao/`）。

## 🔧 技术实现

### 核心技术栈
- **MediaPipe Hands**：手部21个关键点实时追踪（Lite模式，高性能）
- **OpenCV**：图像处理、碰撞检测、PNG透明通道处理、图片旋转和缩放
- **NumPy**：数值计算和矩阵操作
- **cvzone**（可选）：更好的文字显示效果
- **pygame**（可选）：音效播放

### 关键功能
- **坐标平滑算法**：支持EWMA、移动平均、卡尔曼滤波三种算法，自适应速度调整
  - 慢速移动：强平滑，减少抖动
  - 快速移动：减少平滑，保持响应性
- **手指轨迹队列**：使用deque记录最近30个位置点，绘制刀光轨迹
- **物理引擎**：模拟水果抛物线运动、重力效果和旋转
- **碰撞检测**：基于距离的圆形碰撞检测，优化性能
- **PNG图片叠加**：支持alpha通道透明度混合，实现真实叠加效果
- **切割系统**：使用真实的左右半边图片，模拟真实切割效果
- **特效系统**：
  - 刀光特效：跟随切割角度旋转
  - 汁水特效：根据水果类型显示对应颜色，逐渐放大并淡出
  - 连击特效：达到里程碑时显示特殊动画
  - 爆炸特效：炸弹爆炸时的动画效果
- **动画系统**：旋转动画、碎片飞散、透明度渐变

## 🎯 玩法提示

1. 保持手部在摄像头视野内
2. 快速挥动食指效果最好
3. 注意光线充足，提高识别准确度
4. 可以画圆圈、直线、Z字等各种轨迹

## 🔨 自定义修改

可以在代码中调整以下参数：

```python
# 游戏窗口尺寸
WINDOW_WIDTH = 1280
WINDOW_HEIGHT = 720

# 水果生成间隔（帧数，会逐渐加快）
spawn_interval = 5  # 初始间隔
max_fruits_on_screen = 10  # 屏幕上最多同时存在的水果数

# 游戏规则
max_missed = 5  # 最大漏接数
max_bombs_hit = 3  # 最多切到普通炸弹的次数
bomb_spawn_chance = 0.2  # 炸弹生成概率（20%）
deadly_bomb_chance = 0.3  # 致命炸弹概率（30%）
multi_fruit_chance = 0.15  # 特殊水果生成概率（15%）

# 手部检测参数
min_detection_confidence = 0.6  # 检测置信度
min_tracking_confidence = 0.7  # 追踪置信度
model_complexity = 0  # 模型复杂度（0=lite, 1=full）

# 轨迹和平滑
trail_points_maxlen = 30  # 刀光轨迹长度
smoother_method = 'ewma'  # 平滑算法：'ewma', 'moving_avg', 'kalman'
smoother_alpha = 0.4  # EWMA平滑系数
adaptive_smoothing = True  # 是否启用自适应平滑

# 汁水特效参数
juice_initial_scale = 1.2  # 初始缩放
juice_max_scale = 2.0  # 最大缩放
juice_duration = 25  # 持续帧数
```

## 📝 更新日志

### v2.0 (最新版本)
- ✅ 添加汁水特效系统：水果被切碎时根据类型显示对应颜色的汁水炸裂特效
- ✅ 添加连击系统：连续切中水果触发连击，达到10/15/20连击时显示特殊特效
- ✅ 添加炸弹系统：普通炸弹（扣分）和致命炸弹（游戏结束）
- ✅ 添加特殊水果：西瓜和火龙果，切开后分成8片飞散，分值更高
- ✅ 添加刀光选择系统：游戏开始前可选择刀光样式
- ✅ 添加音效支持：切水果和爆炸音效（需要pygame）
- ✅ 优化坐标平滑算法：支持多种算法和自适应速度调整
- ✅ 优化碰撞检测：提高响应速度和准确性
- ✅ 优化游戏平衡：防止炸弹连续出现，动态调整生成速度

### v1.0 (2025-11-06)
- 初始版本发布
- 实现基础手势识别和切水果功能
- 添加刀光轨迹和碎片动画效果
- 完整的游戏逻辑和UI

## 💡 未来优化方向

- [x] ~~使用真实水果图片素材~~ (已完成 ✅)
- [x] ~~添加音效和背景音乐~~ (已完成 ✅)
- [x] ~~增加更多水果种类和特殊道具（炸弹）~~ (已完成 ✅)
- [x] ~~添加连击系统（Combo）~~ (已完成 ✅)
- [x] ~~添加果汁飞溅特效~~ (已完成 ✅)
- [ ] 保存历史最高分和排行榜
- [ ] 多人对战模式
- [ ] 添加更多特效和动画
- [ ] 添加游戏难度选择

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 开源协议

MIT License

---

**祝你游戏愉快！🎉**

